{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/phanu/Automation-n8n%2Bwebiste/Automation-n8n%2Bwebiste/src/app/reportai/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport { Send, Bot, User, Loader2 } from \"lucide-react\";\n\ninterface Message {\n  id: string;\n  content: string;\n  role: \"user\" | \"assistant\";\n  timestamp: Date;\n  isLoading?: boolean;\n}\n\nexport default function ReportAIPage() {\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      id: \"1\",\n      content:\n        \"Hello! I'm your AI assistant for valve maintenance services. How can I help you today?\",\n      role: \"assistant\",\n      timestamp: new Date(),\n    },\n  ]);\n  const [input, setInput] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [sessionId] = useState(() => {\n    if (typeof window !== \"undefined\") {\n      let existing = localStorage.getItem(\"sessionId\");\n      if (!existing) {\n        existing = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        localStorage.setItem(\"sessionId\", existing);\n      }\n      return existing;\n    }\n    return \"\";\n  });\n\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    const es = new EventSource(`/api/sse?sessionId=${sessionId}`);\n    es.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        if (data.type === \"response\") {\n          setMessages((prev) => {\n            const filtered = prev.filter((msg) => !msg.isLoading);\n            return [\n              ...filtered,\n              {\n                id: Date.now().toString(),\n                content: data.message,\n                role: \"assistant\",\n                timestamp: new Date(),\n              },\n            ];\n          });\n          setIsLoading(false);\n        }\n      } catch {}\n    };\n    es.onerror = () => es.close();\n    return () => es.close();\n  }, [sessionId]);\n\n  const sendMessage = async (customInput?: string) => {\n    const content = customInput || input;\n    if (!content.trim() || isLoading) return;\n\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      content,\n      role: \"user\",\n      timestamp: new Date(),\n    };\n\n    setMessages((prev) => [...prev, userMessage, {\n      id: `loading_${Date.now()}`,\n      content: \"Thinking...\",\n      role: \"assistant\",\n      timestamp: new Date(),\n      isLoading: true,\n    }]);\n    setInput(\"\");\n    setIsLoading(true);\n\n    try {\n      const res = await fetch(\"/api/chatreport\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ message: content, history: messages, sessionId }),\n      });\n      const data = await res.json();\n      if (data.message && !data.useSSE) {\n        setMessages((prev) => prev.filter((m) => !m.isLoading).concat({\n          id: Date.now().toString(),\n          content: data.message,\n          role: \"assistant\",\n          timestamp: new Date(),\n        }));\n        setIsLoading(false);\n      }\n    } catch {\n      setMessages((prev) => prev.filter((m) => !m.isLoading).concat({\n        id: Date.now().toString(),\n        content: \"Sorry, there was a problem. Please try again.\",\n        role: \"assistant\",\n        timestamp: new Date(),\n      }));\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-gray-900 to-gray-800 text-white flex flex-col items-center py-12\">\n      <div className=\"max-w-2xl w-full text-center mb-10\">\n        <div className=\"flex flex-col items-center space-y-2\">\n          <div className=\"text-blue-500\">\n            <svg width=\"40\" height=\"40\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path d=\"\"></path>\n            </svg>\n          </div>\n          <h1 className=\"text-3xl font-bold\">AI Assistant</h1>\n          <p className=\"text-gray-400\">Get instant answers about our valve maintenance services</p>\n        </div>\n      </div>\n\n      <div className=\"bg-gray-800/50 backdrop-blur-md rounded-xl p-6 max-w-3xl w-full space-y-4 shadow-lg\">\n        {messages.map((msg) => (\n          <div key={msg.id} className={`flex ${msg.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}>\n            <div className={`p-3 rounded-lg max-w-[75%] ${msg.role === \"user\" ? \"bg-blue-600 text-white\" : \"bg-gray-200 text-gray-900\"}`}>\n              {msg.isLoading ? <Loader2 className=\"animate-spin w-4 h-4 inline\" /> : null}\n              <span className=\"ml-1\">{msg.content}</span>\n            </div>\n          </div>\n        ))}\n        <div ref={messagesEndRef} />\n      </div>\n\n      <div className=\"mt-6 flex w-full max-w-3xl space-x-2\">\n        <input\n          type=\"text\"\n          className=\"flex-1 p-3 rounded-lg bg-gray-900 border border-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          placeholder=\"Type your question about valve services...\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyDown={(e) => { if (e.key === \"Enter\") sendMessage(); }}\n          disabled={isLoading}\n        />\n        <button\n          onClick={() => sendMessage()}\n          className=\"bg-blue-600 p-3 rounded-lg hover:bg-blue-700 transition disabled:opacity-50\"\n          disabled={!input.trim() || isLoading}\n        >\n          <Send size={20} />\n        </button>\n      </div>\n\n      <div className=\"mt-8 w-full max-w-3xl\">\n        <h3 className=\"text-lg font-semibold mb-4\">Quick Questions</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {[\"ขอรายละเอียดงานซ่อม Tage No.: 463TV561 \", \"Tage No.: 463TV561 ใช้เครื่องมืออะไรบ้าง\", \"Tage No.: 463TV561 ใช้เวลาถอดกี่นาที\", \"พื้นที่ 412 มีวาล์วอะไรบ้าง\"].map(q => (\n            <button\n              key={q}\n              onClick={() => sendMessage(q)}\n              className=\"w-full p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition text-left\"\n            >\n              {q}\n            </button>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}