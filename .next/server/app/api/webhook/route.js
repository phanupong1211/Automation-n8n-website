(()=>{var e={};e.id=717,e.ids=[717],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4016:(e,t,r)=>{"use strict";r.d(t,{EQ:()=>s,Vt:()=>n});let o=new Map;function s(e,t){console.log(`[SSE] Attempting to send to session: ${e}`),console.log("[SSE] Available connections:",Array.from(o.keys())),console.log(`[SSE] Total connections: ${o.size}`);let r=o.get(e);if(r)try{return r.enqueue(`data: ${JSON.stringify(t)}

`),console.log(`[SSE] Successfully sent message to session: ${e}`),!0}catch(t){console.error(`[SSE] Error sending to session ${e}:`,t),o.delete(e)}else for(let[r,s]of(console.log(`[SSE] No connection found for session: ${e}`),console.log("[SSE] Searching for partial matches..."),o.entries()))if(r.includes(e)||e.includes(r)){console.log(`[SSE] Found partial match: ${r} for ${e}`);try{return s.enqueue(`data: ${JSON.stringify(t)}

`),console.log(`[SSE] Successfully sent message to partial match: ${r}`),!0}catch(e){console.error(`[SSE] Error sending to partial match ${r}:`,e),o.delete(r)}}return!1}function n(){return{totalConnections:o.size,sessionIds:Array.from(o.keys())}}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5901:(e,t,r)=>{"use strict";r.d(t,{wF:()=>i,F$:()=>u,Rw:()=>l});let o=require("crypto");var s=r.n(o);let n=process.env.WEBHOOK_SECRET||"boom-portfolio-webhook-secret-2024";function a(e){return s().createHmac("sha256",n).update(e,"utf8").digest("hex")}function i(e){return`sha256=${a(e)}`}function l(e,t){return t?t.startsWith("sha256=")?!function(e,t){let r=a(e),o=Buffer.from(`sha256=${r}`,"utf8"),n=Buffer.from(t,"utf8");return o.length===n.length&&s().timingSafeEqual(o,n)}(e,t)?{valid:!1,error:"Invalid signature"}:{valid:!0}:{valid:!1,error:"Invalid signature format"}:{valid:!1,error:"Missing signature header"}}function u(e){let t=Date.now().toString(),r=`${e}:${t}`,o=s().createHmac("sha256",n).update(r,"utf8").digest("hex");return`${t}.${o}`}},6487:()=>{},8008:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>f,serverHooks:()=>m,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>S});var o={};r.r(o),r.d(o,{DELETE:()=>g,GET:()=>p,POST:()=>d});var s=r(6559),n=r(8088),a=r(7719),i=r(2190),l=r(4016),u=r(5901);let c=new Map;async function d(e){try{let t,r=await e.text();try{t=JSON.parse(r)}catch(e){return console.error("Invalid JSON payload error:",e),i.NextResponse.json({error:"Invalid JSON payload"},{status:400})}let o=e.headers.get("x-api-key"),s=e.headers.get("x-signature"),n=!1;if(o&&"boom-portfolio-2024"===o)n=!0,console.log("[Webhook] Authenticated via API key");else if(s){let e=(0,u.Rw)(r,s);e.valid?(n=!0,console.log("[Webhook] Authenticated via signature")):console.log("[Webhook] Signature validation failed:",e.error)}if(!n)return i.NextResponse.json({error:"Unauthorized",message:"Please include either 'x-api-key: boom-portfolio-2024' or valid 'x-signature' header"},{status:401});console.log("Webhook received:",t);let{sessionId:a,response:d,message:p,reply:g,chatId:f,conversationId:h}=t,S="";S=d||p||g||("string"==typeof t?t:"ได้รับข้อมูลจาก AI แล้ว แต่ไม่สามารถแสดงผลได้");let m=a||f||h||Date.now().toString();if(c.set(m,S),a||f||h){let e=(0,l.EQ)(m,{type:"response",message:S,timestamp:new Date().toISOString()});console.log(`SSE message sent to session ${m}:`,e)}let x=Date.now()-3e5;for(let e of c.keys())parseInt(e)<x&&c.delete(e);return i.NextResponse.json({success:!0,message:"Response received and stored",id:m})}catch(e){return console.error("Webhook error:",e),i.NextResponse.json({error:"Failed to process webhook"},{status:500})}}async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"ID parameter required"},{status:400});let o=c.get(r);if(o)return c.delete(r),i.NextResponse.json({success:!0,message:o});return i.NextResponse.json({success:!1,message:"No response found for this ID"})}catch(e){return console.error("Webhook GET error:",e),i.NextResponse.json({error:"Failed to retrieve response"},{status:500})}}function g(e){try{return c.clear(),i.NextResponse.json({success:!0,message:"All pending responses cleared"})}catch(e){return console.error("Webhook DELETE error:",e),i.NextResponse.json({error:"Failed to clear responses"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/webhook/route",pathname:"/api/webhook",filename:"route",bundlePath:"app/api/webhook/route"},resolvedPagePath:"C:\\Users\\phanu\\Automation-n8n+webiste\\Automation-n8n+webiste\\src\\app\\api\\webhook\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:h,workUnitAsyncStorage:S,serverHooks:m}=f;function x(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:S})}},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[719,580],()=>r(8008));module.exports=o})();