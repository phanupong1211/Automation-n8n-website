(()=>{var e={};e.id=501,e.ids=[501],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4016:(e,t,s)=>{"use strict";s.d(t,{EQ:()=>n,Vt:()=>r});let o=new Map;function n(e,t){console.log(`[SSE] Attempting to send to session: ${e}`),console.log("[SSE] Available connections:",Array.from(o.keys())),console.log(`[SSE] Total connections: ${o.size}`);let s=o.get(e);if(s)try{return s.enqueue(`data: ${JSON.stringify(t)}

`),console.log(`[SSE] Successfully sent message to session: ${e}`),!0}catch(t){console.error(`[SSE] Error sending to session ${e}:`,t),o.delete(e)}else for(let[s,n]of(console.log(`[SSE] No connection found for session: ${e}`),console.log("[SSE] Searching for partial matches..."),o.entries()))if(s.includes(e)||e.includes(s)){console.log(`[SSE] Found partial match: ${s} for ${e}`);try{return n.enqueue(`data: ${JSON.stringify(t)}

`),console.log(`[SSE] Successfully sent message to partial match: ${s}`),!0}catch(e){console.error(`[SSE] Error sending to partial match ${s}:`,e),o.delete(s)}}return!1}function r(){return{totalConnections:o.size,sessionIds:Array.from(o.keys())}}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6252:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>S});var o={};s.r(o),s.d(o,{GET:()=>l,POST:()=>u});var n=s(6559),r=s(8088),i=s(7719),a=s(4016);let c=new Map;async function l(e){try{let{searchParams:t}=new URL(e.url),s=t.get("sessionId")||Date.now().toString();console.log(`SSE connection established for session: ${s}`);let o=new ReadableStream({start(t){try{c.set(s,t),t.enqueue(`data: ${JSON.stringify({type:"connected",sessionId:s,message:"เชื่อมต่อ AI สำเร็จ"})}

`),console.log(`SSE initial message sent for session: ${s}`),e.signal.addEventListener("abort",()=>{console.log(`SSE connection closed for session: ${s}`),c.delete(s);try{t.close()}catch(e){console.error("Error closing controller:",e)}})}catch(e){console.error("Error in SSE stream start:",e),c.delete(s)}}});return new Response(o,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET","Access-Control-Allow-Headers":"Cache-Control","X-Accel-Buffering":"no"}})}catch(e){return console.error("Error in SSE GET handler:",e),new Response("SSE Error",{status:500})}}async function u(e){try{let{action:t,sessionId:s,testData:o}=await e.json();if("debug"===t){let e=(0,a.Vt)();return console.log("[SSE Debug] Connection info:",e),new Response(JSON.stringify({success:!0,connectionInfo:e,timestamp:new Date().toISOString()}),{headers:{"Content-Type":"application/json"}})}if("test"===t&&s){let e=(0,a.EQ)(s,o||{type:"test",message:"Test message from debug endpoint"});return new Response(JSON.stringify({success:e,message:e?"Test message sent successfully":"Failed to send test message",sessionId:s,connectionInfo:(0,a.Vt)()}),{headers:{"Content-Type":"application/json"}})}return new Response(JSON.stringify({error:'Invalid action. Use "debug" or "test"'}),{status:400,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("SSE POST error:",e),new Response(JSON.stringify({error:"Failed to process request"}),{status:500,headers:{"Content-Type":"application/json"}})}}let p=new n.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/sse/route",pathname:"/api/sse",filename:"route",bundlePath:"app/api/sse/route"},resolvedPagePath:"C:\\Users\\phanu\\Automation-n8n+webiste\\Automation-n8n+webiste\\src\\app\\api\\sse\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:S,serverHooks:g}=p;function f(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:S})}},6487:()=>{},6559:(e,t,s)=>{"use strict";e.exports=s(4870)},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[719],()=>s(6252));module.exports=o})();