(()=>{var e={};e.id=804,e.ids=[804],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4016:(e,s,o)=>{"use strict";o.d(s,{EQ:()=>t,Vt:()=>r});let n=new Map;function t(e,s){console.log(`[SSE] Attempting to send to session: ${e}`),console.log("[SSE] Available connections:",Array.from(n.keys())),console.log(`[SSE] Total connections: ${n.size}`);let o=n.get(e);if(o)try{return o.enqueue(`data: ${JSON.stringify(s)}

`),console.log(`[SSE] Successfully sent message to session: ${e}`),!0}catch(s){console.error(`[SSE] Error sending to session ${e}:`,s),n.delete(e)}else for(let[o,t]of(console.log(`[SSE] No connection found for session: ${e}`),console.log("[SSE] Searching for partial matches..."),n.entries()))if(o.includes(e)||e.includes(o)){console.log(`[SSE] Found partial match: ${o} for ${e}`);try{return t.enqueue(`data: ${JSON.stringify(s)}

`),console.log(`[SSE] Successfully sent message to partial match: ${o}`),!0}catch(e){console.error(`[SSE] Error sending to partial match ${o}:`,e),n.delete(o)}}return!1}function r(){return{totalConnections:n.size,sessionIds:Array.from(n.keys())}}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9768:(e,s,o)=>{"use strict";o.r(s),o.d(s,{patchFetch:()=>A,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>S,workUnitAsyncStorage:()=>g});var n={};o.r(n),o.d(n,{GET:()=>u,OPTIONS:()=>p,POST:()=>c});var t=o(6559),r=o(8088),i=o(7719),a=o(2190),l=o(4016);async function c(e){try{console.log("=== n8n Public Endpoint Called ==="),console.log("Headers:",Object.fromEntries(e.headers.entries()));let s=await e.json();console.log("Body received:",s);let o=s.response||s.message||s.reply||s.text||s.content||"ข้อความจาก n8n",n=s.sessionId||s.chatId||s.conversationId;if(console.log("Processed response:",o),console.log("Session ID:",n),n){let e=(0,l.EQ)(n,{type:"response",message:o,timestamp:new Date().toISOString()});if(console.log(`✅ SSE message sent to session ${n}:`,e),e)return a.NextResponse.json({success:!0,message:"✅ Response sent to chat via SSE",sessionId:n,processedResponse:o,timestamp:new Date().toISOString()},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}});console.log(`❌ Failed to send SSE message to session ${n}`)}else console.log("❌ No session ID found in request");return a.NextResponse.json({success:!0,message:"✅ Response received successfully from n8n",processedResponse:o,timestamp:new Date().toISOString(),receivedData:s},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}catch(e){return console.error("❌ n8n public endpoint error:",e),a.NextResponse.json({success:!1,error:"Failed to process n8n response",details:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()},{status:500})}}async function p(){return new a.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}async function u(){return a.NextResponse.json({status:"\uD83D\uDFE2 ACTIVE",message:"n8n public endpoint is running - NO AUTHENTICATION REQUIRED",timestamp:new Date().toISOString(),endpoint:"/api/public/n8n",methods:["POST","GET","OPTIONS"],example:{url:"http://localhost:3000/api/public/n8n",method:"POST",headers:{"Content-Type":"application/json"},body:{response:"Your AI response here",sessionId:"optional-session-id"}}})}let d=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/public/n8n/route",pathname:"/api/public/n8n",filename:"route",bundlePath:"app/api/public/n8n/route"},resolvedPagePath:"C:\\Users\\phanu\\Automation-n8n+webiste\\Automation-n8n+webiste\\src\\app\\api\\public\\n8n\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:S,workUnitAsyncStorage:g,serverHooks:m}=d;function A(){return(0,i.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:g})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var o=e=>s(s.s=e),n=s.X(0,[719,580],()=>o(9768));module.exports=n})();