(()=>{var e={};e.id=970,e.ids=[970],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5191:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>m,routeModule:()=>h,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>f});var o={};s.r(o),s.d(o,{POST:()=>p});var r=s(6559),n=s(8088),a=s(7719),i=s(2190),l=s(5901);let c={name:"์NIS Automation AI Report",title:"AI Report",contact:{phone:"(+66) 85-835-1266",email:"Phanupong_C@npp.co.th",address:"1 tatoom, Srimahapot, Prachin buri 25140, Thailand"}};function u(e){return e.includes("contact")||e.includes("email")||e.includes("phone")||e.includes("reach")||e.includes("ติดต่อ")?`ขณะนี้ระบบตอบคำถามอัจฉริยะขัดข้อง คุณสามารถติดต่อทีม Instrument service ได้ที่:
    📧 Email: ${c.contact.email}
    📱 Phone: ${c.contact.phone}

  เรายินดีให้คำปรึกษาและออกแบบบริการตรวจสอบ/ซ่อมบำรุงให้เหมาะกับโรงงานหรือหน่วยงานของคุณ!`:`ขอบคุณสำหรับคำถามครับ! ขณะนี้ระบบตอบคำถามอัจฉริยะขัดข้อง หากคุณสนใจเรื่องงานซ่อมบำรุง วาล์ว เซฟตี้วาล์ว แท่นชั่งดิจิทัล ระบบวัดอัตราการไหล หรือ IoT สามารถติดต่อช่องทางดังนี้ได้เลยครับ😀

  📧 Email: ${c.contact.email}, 
  📱 Phone: ${c.contact.phone}
  `}async function p(e){let t="",s="";try{let{message:o,history:r,sessionId:n}=await e.json();if(t=o||"",s=n||`session_${Date.now()}`,!t)return i.NextResponse.json({error:"Message is required"},{status:400});console.log(`[Chat API] Session: ${s}, Message: ${t.substring(0,50)}...`);try{let e=JSON.stringify({message:t,history:r,portfolioData:c,sessionId:s,responseUrl:"http://localhost:3001/api/webhook",sessionToken:(0,l.F$)(s),timestamp:new Date().toISOString()}),o=(0,l.wF)(e),n=await fetch("http://localhost:5678/webhook/8bdc9363-b386-44cb-a05c-cd168d0f8608",{method:"POST",headers:{"Content-Type":"application/json","x-session-id":s,"x-webhook-source":"portfolio-chat","x-signature":o},body:e,signal:AbortSignal.timeout(15e3)});if(n.ok){let e=await n.json();if(console.log(`[Chat API] Webhook success for session ${s}:`,e),e.useSSE||e.async||"processing"===e.status||e.message&&e.message.includes("Workflow was started"))return console.log(`[Chat API] Using SSE mode for session ${s} - n8n will send response later`),i.NextResponse.json({success:!0,useSSE:!0,sessionId:s,message:"Response will be sent via real-time connection"});let t="";if("string"==typeof e)t=e;else if(e.response)t=e.response;else if(e.message)t=e.message;else if(e.reply)t=e.reply;else if(e.text)t=e.text;else throw console.log("[Chat API] Unexpected webhook response format:",e),console.log(`[Chat API] Using fallback response for session ${s}`),Error("Unexpected webhook response format");return console.log(`[Chat API] Immediate response for session ${s}:`,t),i.NextResponse.json({message:t,useSSE:!1})}{let e=await n.text();throw console.log(`[Chat API] Webhook error ${n.status}:`,e),Error(`Webhook returned status: ${n.status}`)}}catch(o){console.log(`[Chat API] Webhook failed for session ${s}, using fallback:`,o);let e=u(t.toLowerCase());return console.log(`[Chat API] Fallback response for session ${s}:`,e.substring(0,100)+"..."),i.NextResponse.json({message:e,useSSE:!1,fallback:!0})}}catch(o){console.error(`[Chat API] Final error for session ${s}:`,o);let e=u(t.toLowerCase()||"");return console.log(`[Chat API] Final fallback response for session ${s}:`,e.substring(0,100)+"..."),i.NextResponse.json({message:e,useSSE:!1,fallback:!0,error:"System temporarily unavailable"})}}let h=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/chatreport/route",pathname:"/api/chatreport",filename:"route",bundlePath:"app/api/chatreport/route"},resolvedPagePath:"C:\\Users\\phanu\\Automation-n8n+webiste\\Automation-n8n+webiste\\src\\app\\api\\chatreport\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:f,serverHooks:g}=h;function m(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:f})}},5901:(e,t,s)=>{"use strict";s.d(t,{wF:()=>i,F$:()=>c,Rw:()=>l});let o=require("crypto");var r=s.n(o);let n=process.env.WEBHOOK_SECRET||"boom-portfolio-webhook-secret-2024";function a(e){return r().createHmac("sha256",n).update(e,"utf8").digest("hex")}function i(e){return`sha256=${a(e)}`}function l(e,t){return t?t.startsWith("sha256=")?!function(e,t){let s=a(e),o=Buffer.from(`sha256=${s}`,"utf8"),n=Buffer.from(t,"utf8");return o.length===n.length&&r().timingSafeEqual(o,n)}(e,t)?{valid:!1,error:"Invalid signature"}:{valid:!0}:{valid:!1,error:"Invalid signature format"}:{valid:!1,error:"Missing signature header"}}function c(e){let t=Date.now().toString(),s=`${e}:${t}`,o=r().createHmac("sha256",n).update(s,"utf8").digest("hex");return`${t}.${o}`}},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[719,580],()=>s(5191));module.exports=o})();