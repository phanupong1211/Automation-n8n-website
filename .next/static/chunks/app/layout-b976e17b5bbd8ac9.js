(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},1773:(e,t,s)=>{"use strict";s.d(t,{ChatWidgetWrapper:()=>b});var a=s(5155),r=s(5695),o=s(2115),n=s(4416),i=s(1366),l=s(1007),c=s(5657),d=s(1154),m=s(2486),g=s(4105),h=s(760);function u(){let[e,t]=(0,o.useState)(!1),[s]=(0,o.useState)(()=>{{let e=localStorage.getItem("sessionId");return e||(e="session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("sessionId",e)),e}}),[r,u]=(0,o.useState)([{id:"1",content:"สวัสดีครับ! ผมเป็น AI ผู้ช่วยของทีม Instrument สามารถถามเกี่ยวกับประสบการณ์ ทักษะ หรือโครงการของเขาได้เลยครับ!",role:"assistant",timestamp:new Date}]),[b,x]=(0,o.useState)(""),[p,f]=(0,o.useState)(!1),[w,y]=(0,o.useState)(null),[v,j]=(0,o.useState)("disconnected"),N=(0,o.useRef)(null),S=()=>{var e;null==(e=N.current)||e.scrollIntoView({behavior:"smooth"})};(0,o.useEffect)(()=>{S()},[r]),(0,o.useEffect)(()=>{if(!w){console.log("[SSE] Connecting immediately with sessionId: ".concat(s));let e=new EventSource("/api/sse?sessionId=".concat(s));e.onopen=()=>{console.log("[SSE] Connection opened for sessionId: ".concat(s)),j("connected")},e.onmessage=e=>{try{let t=JSON.parse(e.data);"connected"===t.type?j("connected"):"response"===t.type&&(u(e=>[...e.filter(e=>!e.isLoading),{id:Date.now().toString(),content:t.message,role:"assistant",timestamp:new Date}]),f(!1))}catch(e){console.error("SSE parse error:",e)}},e.onerror=t=>{console.error("SSE error:",t),j("disconnected"),e.close(),y(null)},y(e)}},[s,w,y,j,u,f]),(0,o.useEffect)(()=>()=>{w&&w.close()},[w]);let k=async()=>{if(!b.trim()||p)return;let e={id:Date.now().toString(),content:b,role:"user",timestamp:new Date},t={id:"loading_".concat(Date.now()),content:"กำลังคิด...",role:"assistant",timestamp:new Date,isLoading:!0};u(s=>[...s,e,t]),x(""),f(!0);let a=setTimeout(()=>{p&&(u(e=>[...e.filter(e=>!e.isLoading),{id:(Date.now()+2).toString(),content:"ขออภัยครับ การตอบกลับใช้เวลานานกว่าปกติ กรุณาลองใหม่อีกครั้งครับ",role:"assistant",timestamp:new Date}]),f(!1))},3e4);try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:b,history:r,sessionId:s})});if(!e.ok){let t=await e.text();throw console.error("API Error:",e.status,t),"new Error(API Error: ".concat(e.status,")")}let t=await e.json();clearTimeout(a),t.message&&!t.useSSE?(console.log("Received immediate response:",t),u(e=>[...e.filter(e=>!e.isLoading),{id:(Date.now()+1).toString(),content:t.message,role:"assistant",timestamp:new Date}]),f(!1)):"disconnected"===v&&t.message?(console.log("Using fallback response due to disconnected SSE:",t),u(e=>[...e.filter(e=>!e.isLoading),{id:(Date.now()+1).toString(),content:t.message,role:"assistant",timestamp:new Date}]),f(!1)):t.useSSE?console.log("Waiting for SSE response for session:",s):(console.log("No clear response format, using fallback"),u(e=>[...e.filter(e=>!e.isLoading),{id:(Date.now()+1).toString(),content:"ขออภัยครับ ได้รับข้อความแล้ว แต่ระบบมีปัญหาในการตอบกลับ กรุณาลองใหม่อีกครั้งครับ",role:"assistant",timestamp:new Date}]),f(!1))}catch(e){console.error("Error sending message:",e),clearTimeout(a),u(e=>[...e.filter(e=>!e.isLoading),{id:(Date.now()+1).toString(),content:"ขออภัยครับ ตอนนี้มีปัญหาในการตอบกลับ กรุณาลองใหม่อีกครั้งครับ",role:"assistant",timestamp:new Date}]),f(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.P.button,{initial:{scale:0},animate:{scale:1},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>t(!e),className:"fixed bottom-4 right-4 sm:bottom-6 sm:right-6 z-50 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white p-3 sm:p-4 rounded-full shadow-lg transition-all duration-200 hover:scale-110","aria-label":"Toggle chat",children:e?(0,a.jsx)(n.A,{size:24}):(0,a.jsx)(i.A,{size:24})}),(0,a.jsx)(h.N,{children:e&&(0,a.jsxs)(g.P.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:"fixed bottom-16 right-4 sm:bottom-24 sm:right-6 z-40 w-80 sm:w-96 h-[30rem] sm:h-[35rem] max-w-[calc(100vw-2rem)] bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-blue-600 dark:bg-blue-500 text-white p-4 rounded-t-lg",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"คุยกับ AI ของทีม"}),(0,a.jsx)("p",{className:"text-sm text-blue-100 dark:text-blue-200",children:"ถามอะไรเกี่ยวกับทีม Instrument ได้เลย!"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[r.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-2 max-w-[80%] ".concat("user"===e.role?"flex-row-reverse space-x-reverse":""),children:[(0,a.jsx)("div",{className:"p-2 rounded-full ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"user"===e.role?(0,a.jsx)(l.A,{size:16}):(0,a.jsx)(c.A,{size:16})}),(0,a.jsx)("div",{className:"p-3 rounded-lg ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"),children:e.isLoading?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(d.A,{size:16,className:"animate-spin"}),(0,a.jsx)("p",{className:"text-sm",children:e.content})]}):(0,a.jsx)("p",{className:"text-sm",children:e.content})})]})},e.id)),(0,a.jsx)("div",{ref:N})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:b,onChange:e=>x(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())},placeholder:"ถามอะไรก็ได้...",className:"flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p}),(0,a.jsx)("button",{onClick:k,disabled:!b.trim()||p,className:"p-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:(0,a.jsx)(m.A,{size:16})})]})})]})})]})}function b(){return(0,r.usePathname)().startsWith("/reportai")?null:(0,a.jsx)(u,{})}},5506:(e,t,s)=>{"use strict";s.d(t,{Navigation:()=>g});var a=s(5155),r=s(6766),o=s(2115),n=s(6874),i=s.n(n),l=s(4416),c=s(4783),d=s(4105),m=s(760);function g(){let[e,t]=(0,o.useState)(!1),[s,n]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=()=>{n(window.scrollY>50)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);let g=[{href:"/",label:"Home"},{href:"/#about",label:"About"},{href:"/#experience",label:"Experience"},{href:"/reviews",label:"Reviews"},{href:"/document",label:"Document"},{href:"/training",label:"Training"},{href:"/#contact",label:"Contact"}];return(0,a.jsxs)(d.P.nav,{initial:{y:-100},animate:{y:0},className:"fixed top-0 left-0 right-0 z-50 transition-all duration-300 ".concat(s?"bg-white/20 backdrop-blur-md shadow-lg border-b border-gray-200/20":"bg-transparent"),children:[(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)(i(),{href:"/",className:"flex items-center gap-2",children:(0,a.jsx)(r.default,{src:"/images/logo.png",alt:"NIS Automation Logo",width:50,height:100,className:"h-8 w-auto object-contain"})}),(0,a.jsx)("div",{className:"hidden md:flex items-center space-x-8",children:g.map(e=>(0,a.jsx)(i(),{href:e.href,className:"text-gray-800 dark:text-gray-100 hover:text-blue-900 transition-colors duration-200 font-medium",children:e.label},e.href))}),(0,a.jsx)("div",{className:"md:hidden",children:(0,a.jsx)("button",{onClick:()=>t(!e),className:"p-2 rounded-lg bg-white text-black hover:bg-gray-100 transition-colors duration-200 border border-gray-200","aria-label":"Toggle menu",children:e?(0,a.jsx)(l.A,{size:24}):(0,a.jsx)(c.A,{size:24})})})]})}),(0,a.jsx)(m.N,{children:e&&(0,a.jsx)(d.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"md:hidden bg-white border-t border-gray-200",children:(0,a.jsx)("div",{className:"px-4 py-2 space-y-1",children:g.map(e=>(0,a.jsx)(i(),{href:e.href,onClick:()=>t(!1),className:"block px-3 py-2 text-black hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors duration-200",children:e.label},e.href))})})})]})}},8590:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2093,23)),Promise.resolve().then(s.t.bind(s,7735,23)),Promise.resolve().then(s.t.bind(s,347,23)),Promise.resolve().then(s.t.bind(s,6769,23)),Promise.resolve().then(s.bind(s,1773)),Promise.resolve().then(s.bind(s,5506))}},e=>{var t=t=>e(e.s=t);e.O(0,[399,766,105,874,528,441,684,358],()=>t(8590)),_N_E=e.O()}]);